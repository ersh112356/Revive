var Revive=function(t){var i={},r={},n={},s=t,u={},c={};this.clear=function(){return i={},r={},this},this.setBroker=function(t){return s=t,this},this.emit=function(t,e,i,n){if(n)var r=s.subscribe({channel:t,topic:e+"_reply",callback:function(t,e){r.unsubscribe(),clearTimeout(c),n(t,e)}}),c=setTimeout(function(){r.unsubscribe()},3e4);return s.publish({channel:t,topic:e,data:i}),this},this.apply=function(t,e,i,n){return"function"==typeof i?a(t,e,i):h(t,e,i,n),this};var a=function(t,e,n){var i=s.subscribe({channel:t,topic:e,callback:function(t,e){var i=new y(e);n(t,i)}}),r=t+"."+e,c=u[r];c||(c=[]),c.push(i),u[r]=c},h=function(t,e,i,n){var r=s.subscribe({channel:t,topic:e,callback:function(t,e){var i=new y(e);n(t,i)}});r.identification=i;var c=t+"."+e,a=u[c];a||(a=[]),a.push(r),u[c]=a};this.unapply=function(t,e,i){return i?o(t,e,i):l(t,e),this};var l=function(t,e){try{var i=t+"."+e,n=u[i];if(n)for(var r=0;r<n.length;r++)n[r].unsubscribe();u[i]=[]}catch(t){}},o=function(t,e,i){try{var n=u[t+"."+e];if(n)for(var r=0;r<n.length;r++){var c=n[r];if(c.identification===i){c.unsubscribe(),n.splice(r,1);break}}}catch(t){}};this.publish=function(t,e){return c[t]=e,this},this.getRecord=function(t){return c[t]},this.on=function(t,e,i){var n=$("#"+t);return n.on(e,function(t){"click"===e&&n.attr("disabled")||i(t),t.preventDefault()}),this},this.asState=function(t){var e={},i=$("#"+t);return e.html=i.html(),e.text=i.text(),e.css=i.attr("style"),e.class=i.attr("class"),e.id=t,e.disabled=i.attr("disabled"),e.src=i.attr("src"),e.href=i.attr("href"),e.width=i.attr("width"),e.height=i.attr("height"),e.alt=i.attr("alt"),e.title=i.attr("title"),e.checked=i.attr("checked"),e.selected=i.attr("selected"),e.visible=i.is(":visible"),e},this.store=function(t,e){return i[t]=e,this},this.restoreAll=function(t){var e=i[t];try{e.forEach(function(t){f(t)})}catch(t){}return this},this.restore=function(t){var e=i[t];return f(e),this},this.play=function(t,e){return r[t]=e,this},this.replay=function(t){for(var e=r[t],i=0;i<e.length;i++){var n=e[i];f(n)}return this},this.toggle=function(t,e){var i=n[t+"_"+e];return i&&1===i?(n[t+"_"+e]=2,this.replay(e)):(n[t+"_"+e]=1,this.replay(t)),this};var f=function(t){var e=t.id;t.html?v(e,t.html):t.text&&d(e,t.text),t.css&&p(e,t.css),t.visible?$("#"+e).show():$("#"+e).hide(),b(e,"class",t.class),b(e,"src",t.src),b(e,"href",t.href),b(e,"width",t.width),b(e,"height",t.height),b(e,"alt",t.alt),b(e,"title",t.title),b(e,"disabled",t.disabled),b(e,"checked",t.checked),b(e,"selected",t.selected)},v=function(t,e){$("#"+t).html(e)},d=function(t,e){$("#"+t).text(e)},p=function(t,e){$("#"+t).css(e)},b=function(t,e,i){var n=$("#"+t);i?n.attr(e,i):n.removeAttr(e)},y=function(e){return{channel:e.channel,topic:e.topic,timeStamp:e.timeStamp,data:e.data,reply:function(t){s.publish({channel:e.channel,topic:e.topic+"_reply",data:t})}}}};revive=new Revive(this.postal),function(){var t=document.querySelectorAll("[revive-data]");if(t)for(var e=0;e<t.length;e++){var i=t[e].getAttribute("revive-data"),n=t[e].getAttribute("revive-fn"),r=t[e].getAttribute("id"),c=t[e].getAttribute("revive-type");if(n)revive.on(r,c,function(t){var e=window[n];"function"==typeof e&&(e(t,i),t.preventDefault())});else{var a=JSON.parse(i);revive.on(r,c,function(t){revive.emit(a.channel,a.topic,a.data)})}}}();
